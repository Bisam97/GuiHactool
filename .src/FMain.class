' Gambas class file


Public $Workdir As String
Public $ProdKeylist As Collection

Public Sub Form_Open()


  If Exist(User.Home & "/.switch/prod.keys") Then
    LoadKeys()


  Else
    Message.Info("Please Connect to the SD card of your Switch\n and Select the root dir of the SD card")
    Dialog.Title = "Select the SD Card root of your switch"
    Dialog.Path = "/media/"
    If Dialog.SelectDirectory() Then
      Message.Error("With out Key the Programm can't work :(\n Bye")
      Quit 2
    Else
      $Workdir = Dialog.Path
      If Exist($Workdir &/ "switch/prod.keys") And Exist($Workdir &/ "switch/title.keys") Then
        Copy $Workdir &/ "switch/prod.keys" To User.Home &/ ".switch/prod.keys"
        Copy $Workdir &/ "switch/title.keys" To User.Home &/ ".switch/title.keys"
      Endif
      LoadKeys()
    Endif
  Endif

End

Public Sub LoadKeys()

  Dim sFile As String
  Dim a As String[]
  Dim s As String

  $ProdKeylist = New Collection
  sFile = File.Load(User.Home & "/.switch/prod.keys")
  For Each s In Split(sFile, gb.NewLine, "", True)

    a = Split(s, "= ", "", True)

    $ProdKeylist.Add(a[1], a[0])
  Next
  Message.Info("Keys was loaded")



End

Public Sub Button1_Click()

  Dump.show()
  Dump.X = FMain.X

End

Public Sub Button2_Click()

  Decrypt.Show()

End

Public Sub Button3_Click()

  Extract.Show()

End

Public Sub Button5_Click()

  FallBackup.show

End

Public Sub Button6_Click()

  FTitleName.Show()

End

Public Sub Form_Close()

  Wait 1
  Quit

End